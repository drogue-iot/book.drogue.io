<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../../../../../_'</script>
    <link rel="icon" href="../../../../../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">

      <a class="navbar-item" href="../../../../../..">
        <img class="navbar-brand-image" src="../../../../../../_/img/logo.png" alt="Drogue IoT"/>
      </a>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
          </div>
        </div>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.drogue.io" target="_blank">Project</a>
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-device" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../../index.html">Drogue Device</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../concepts.html">Actors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../getting_started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../basic_application.html">Basic Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../drivers.html">Drivers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../bsp.html">Board Support Packages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../../../../embassy/dev/index.html">Embassy</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../../examples.html">Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rp/pico/blinky/README.html">Raspberry Pi Pico Blinky</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32h7/nucleo-h743zi/blinky/README.html">STM32 Nucleo-H743 blinky</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32u5/iot02a/blinky/README.html">STM32 IoT Discovery board blinky</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ble</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/adafruit-feather-nrf52840/bt-mesh/README.html">Adafruit Feather nRF52840 Bluetooth Mesh example</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/ble/README.html">Microbit BLE Sensor example with DFU</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/nrf52840-dk/ble-mesh/README.html">nrf52840-dk BLE Mesh example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/esp8266/http/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + HTTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/esp8266/mqtt/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + MQTT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../std/cloud/README.html">Example sending telemetry data from Drogue Device to Drogue Cloud</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../std/esp8266/README.html">Example using a USB-to-Serial adapter + ESP8266 adapter</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="README.html">STM32 IoT Discovery board (iot01a) reporting sensor data using WiFi</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Display</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/compass/README.html">BBC micro:bit v2 compass showing direction in led display</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/jukebox/README.html">BBC micro:bit v2 disco jukebox and light show</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/uart/README.html">BBC micro:bit v2 uart and matrix display</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32h7/nucleo-h743zi/epd/README.html">STM32 Nucleo-H743 7-color e-paper display</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lorawan</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../std/rak811/README.html">RAK811 LoRa Adapter with AT command firmware</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32l0/lora-discovery/README.html">STM32 LoRaWAN Discovery board connecting to The Things Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32l1/rak811/README.html">RAK811 Tracker Node connecting to The Things Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32wl/nucleo-wl55/lorawan-dfu/README.html">STM32 Nucleo-WL55 LoRaWAN and firmware updates OTA</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32wl/nucleo-wl55/lorawan/README.html">STM32 Nucleo-WL55 using LoRaWAN connecting to The Things Network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/adafruit-feather-nrf52840/bootloader/README.html">Bootloader for Adafruit nRF52840 chips</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/bootloader/README.html">Bootloader for BBC Micro:bit chips</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../bootloader/README.html">Bootloader for STM32L4 iot01a boards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../stm32wl/nucleo-wl55/bootloader/README.html">Bootloader for STM32L4 iot01a boards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Uart</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/uart/README.html">BBC micro:bit v2 uart and matrix display</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Wifi</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/esp8266/http/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + HTTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../nrf52/microbit/esp8266/mqtt/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + MQTT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../std/esp8266/README.html">Example using a USB-to-Serial adapter + ESP8266 adapter</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="README.html">STM32 IoT Discovery board (iot01a) reporting sensor data using WiFi</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Device</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../../../drogue-cloud/dev/index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../../drogue-cloud/dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.9/index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../../../drogue-cloud/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../../index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../../embassy/dev/index.html">Embassy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../../embassy/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">Drogue Device</a></li>
    <li><a href="../../../../examples.html">Examples</a></li>
    <li>Cloud</li>
    <li><a href="README.html">STM32 IoT Discovery board (iot01a) reporting sensor data using WiFi</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-device/edit/main/docs/modules/ROOT/pages/examples/stm32l4/iot01a/wifi/README.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_stm32_iot01a_example"><a class="anchor" href="#_stm32_iot01a_example"></a>STM32 IOT01A example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example application runs out of the box on the STM32 IOT01A development kits. The example can also be compiled with a <code>dfu</code> flag to enable firmware update capabilities.</p>
</div>
<div class="paragraph">
<p>It uses the on board peripherals such as WiFi and the temperature sensor to send data to an HTTP endpoint such as Drogue Cloud, and (if the <code>dfu</code> feature is enabled) retrieve firmware updates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are multiple variants of this kit, so the example must be compiled and run using feature flags.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example can operate using plain TCP, or using TLS by enabling the <code>tls</code> feature flag.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="sect3">
<h4 id="_hardware"><a class="anchor" href="#_hardware"></a>Hardware</h4>
<div class="ulist">
<ul>
<li>
<p>STM32 IOT01A development kit</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_software"><a class="anchor" href="#_software"></a>Software</h4>
<div class="ulist">
<ul>
<li>
<p>To build the example, you need to have <a href="https://rustup.rs/">rustup</a>.</p>
</li>
<li>
<p>To flash the example on the device, you need <code>probe-run</code> installed (<code>cargo install probe-run</code>).</p>
</li>
<li>
<p>A Drogue Cloud instance. See <a href="https://github.com/drogue-iot/drogue-cloud/">drogue-cloud</a> for how to run that, or use the <a href="https://sandbox.drogue.cloud/">sandbox</a> (requires TLS).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring"><a class="anchor" href="#_configuring"></a>Configuring</h3>
<div class="paragraph">
<p>Credentials for your local WiFi network will come from these entries in <code>~/.drogue/config.toml</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>wifi-ssid = "..."
wifi-password = "..."</pre>
</div>
</div>
<div class="paragraph">
<p>HTTP authentication will come from these entries in <code>~/.drogue/config.toml</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http-username = "..."
http-password = "..."</pre>
</div>
</div>
<div class="paragraph">
<p>For Drogue Cloud, the username/password is stored in this form: <code>device_id@application</code>.</p>
</div>
<div class="paragraph">
<p>If you have the B-L4S5I-IOT01A board, set the following environment variables:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export CHIP=STM32L4S5VI
export CHIP_FEATURE=b-l4s5i-iot01a</pre>
</div>
</div>
<div class="paragraph">
<p>If you have the B-475E-IOT01A board, use the following settings instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export CHIP=STM32L475VGTx
export CHIP_FEATURE=b-l475e-iot01a</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_with_plain_tcp"><a class="anchor" href="#_running_with_plain_tcp"></a>Running with plain TCP</h3>
<div class="paragraph">
<p>You can configure the IP constant to point to any HTTP server to receive events, or you can use <a href="https://github.com/drogue-iot/drogue-cloud/">drogue cloud</a> locally. For simplicity, start a local HTTP server in python that echoes the HTTP payload back:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -s https://raw.githubusercontent.com/drogue-iot/drogue-device/main/apps/drogue-temperature/server.py | python3</pre>
</div>
</div>
<div class="paragraph">
<p>To run the firmware using a given chip:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DEFMT_LOG=info PROBE_RUN_CHIP=${CHIP} --release --features ${CHIP_FEATURE},debug --no-default-features</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_with_tls"><a class="anchor" href="#_running_with_tls"></a>Running with TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the <code>tls</code> flag is enabled, the example is configured to use the Drogue Cloud sandbox. To use this example with your own Drogue Cloud instance, you need to edit the HOST and PORT constants in <code>src/main.rs</code>.</p>
</div>
<div class="paragraph">
<p>To run the firmware using a given chip:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DEFMT_LOG=info PROBE_RUN_CHIP=${CHIP} cargo run --release --features ${CHIP_FEATURE},tls,debug --no-default-features</pre>
</div>
</div>
<div class="paragraph">
<p>Once flashed, the device will reset and attempt to join the WiFi network. If successful, it will print a message to the RTT log. You can then press the blue/user button on the board to send a test message from the device.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_firmware_update_capabilities"><a class="anchor" href="#_enabling_firmware_update_capabilities"></a>Enabling firmware update capabilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this step, we need to flash a bootloader as well as the application. When the <code>dfu</code> flag is enabled, the example is configured to enable firmware updates using Drogue Cloud sandbox.</p>
</div>
<div class="sect2">
<h3 id="_flashing_the_bootloader"><a class="anchor" href="#_flashing_the_bootloader"></a>Flashing the bootloader</h3>
<div class="paragraph">
<p>To flash the bootloader for a given chip:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cargo flash --manifest-path ../bootloader/Cargo.toml --release --features ${CHIP_FEATURE} --no-default-features --chip ${CHIP}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_application"><a class="anchor" href="#_running_the_application"></a>Running the application</h3>
<div class="paragraph">
<p>To run the application using a given chip:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DEFMT_LOG=info PROBE_RUN_CHIP=${CHIP} cargo run --release --features ${CHIP_FEATURE},tls,dfu,debug --no-default-features</pre>
</div>
</div>
<div class="paragraph">
<p>Once flashed, the device will reset and attempt to join the WiFi network as before, in addition to polling the Drogue Cloud for firmware update commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you’re experiencing problems, try setting the <code>VID:PID</code> values to that of your probe (you can find that from lsusb once your board is powered).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ENV&gt; cargo run &lt;ARGS&gt; -- --probe &lt;VID&gt;:&lt;PID&gt;</pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../_/css/search.css"></script>
<script async src="../../../../../../search-index.js"></script>
  </body>
</html>
