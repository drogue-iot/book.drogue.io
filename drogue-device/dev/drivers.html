<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Drivers :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">

      <a class="navbar-item" href="../..">
        <img class="navbar-brand-image" src="../../_/img/logo.png" alt="Drogue IoT"/>
      </a>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
          </div>
        </div>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.drogue.io" target="_blank">Project</a>
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-device" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Drogue Device</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="concepts.html">Actors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting_started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="basic_application.html">Basic Application</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="drivers.html">Drivers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bsp.html">Board Support Packages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../embassy/dev/index.html">Embassy</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="examples.html">Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/rp/pico/blinky/README.html">Raspberry Pi Pico Blinky</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32h7/nucleo-h743zi/blinky/README.html">STM32 Nucleo-H743 blinky</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32u5/iot02a/blinky/README.html">STM32 IoT Discovery board blinky</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ble</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/adafruit-feather-nrf52840/bt-mesh/README.html">Adafruit Feather nRF52840 Bluetooth Mesh example</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/ble/README.html">Microbit BLE Sensor example with DFU</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/bt-mesh/README.html">Microbit Bluetooth Mesh example</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/nrf52840-dk/ble-mesh/README.html">nrf52840-dk BLE Mesh example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/esp8266/http/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + HTTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/esp8266/mqtt/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + MQTT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/std/cloud/README.html">Example sending telemetry data from Drogue Device to Drogue Cloud</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/std/esp8266/README.html">Example using a USB-to-Serial adapter + ESP8266 adapter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32l4/iot01a/wifi/README.html">STM32 IoT Discovery board (iot01a) reporting sensor data using WiFi</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Display</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/compass/README.html">BBC micro:bit v2 compass showing direction in led display</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/jukebox/README.html">BBC micro:bit v2 disco jukebox and light show</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32h7/nucleo-h743zi/epd/README.html">STM32 Nucleo-H743 7-color e-paper display</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lorawan</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/std/rak811/README.html">RAK811 LoRa Adapter with AT command firmware</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32l0/lora-discovery/README.html">STM32 LoRaWAN Discovery board connecting to The Things Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32l1/rak811/README.html">RAK811 Tracker Node connecting to The Things Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32wl/nucleo-wl55/lorawan-dfu/README.html">STM32 Nucleo-WL55 LoRaWAN and firmware updates OTA</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32wl/nucleo-wl55/lorawan/README.html">STM32 Nucleo-WL55 using LoRaWAN connecting to The Things Network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/adafruit-feather-nrf52840/bootloader/README.html">Bootloader for Adafruit nRF52840 chips</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/bootloader/README.html">Bootloader for BBC Micro:bit chips</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32l4/iot01a/bootloader/README.html">Bootloader for STM32L4 iot01a boards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32wl/nucleo-wl55/bootloader/README.html">Bootloader for STM32L4 iot01a boards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Wifi</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/esp8266/http/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + HTTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/nrf52/microbit/esp8266/mqtt/README.html">BBC micro:bit v2 + ESP8266 WiFi adapter + MQTT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/std/esp8266/README.html">Example using a USB-to-Serial adapter + ESP8266 adapter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="examples/stm32l4/iot01a/wifi/README.html">STM32 IoT Discovery board (iot01a) reporting sensor data using WiFi</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Device</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../drogue-ajour/dev/index.html">Drogue Ajour</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-ajour/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-cloud/dev/index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-cloud/dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.9/index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../embassy/dev/index.html">Embassy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../embassy/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Drogue Device</a></li>
    <li><a href="drivers.html">Drivers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-device/edit/main/docs/modules/ROOT/pages/drivers.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Drivers</h1>
<div class="sect1">
<h2 id="_writing_async_drivers"><a class="anchor" href="#_writing_async_drivers"></a>Writing async drivers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Async Drivers follow a common set of patterns that makes it easier to write new drivers. Device drivers can be written in different
ways, but the common approach is to implement one or more of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new Rust crate that implements the driver.</p>
</li>
<li>
<p>Implement traits from <code>embedded-hal-async</code> if relevant.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_an_async_trait"><a class="anchor" href="#_writing_an_async_trait"></a>Writing an async trait</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unfortunately, the support in Rust for writing async traits is limited, but it is possible using features from Rust nightly.</p>
</div>
<div class="paragraph">
<p>An async trait can be specified by enabling a feature named generic associcated types (GAT):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">#![feature(generic_associated_types)]

pub trait Counter {
    type IncrementFuture&lt;'m&gt;: Future&lt;Output = u32&gt; where Self: 'm;
    fn increment&lt;'m&gt;(&amp;'m mut self) -&gt; Self::IncrementFuture&lt;'m&gt;;

    type AddFuture&lt;'m&gt;: Future&lt;Output = u32&gt; where Self: 'm;
    fn add&lt;'m&gt;(&amp;'m mut self, value: u32) -&gt; Self::AddFuture&lt;'m&gt;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An implementor of the above trait will be able to write async code with some boilerplate, and application code can rely on the trait.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_an_async_driver"><a class="anchor" href="#_writing_an_async_driver"></a>Writing an async driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A driver is an implementation of the trait that applications use. With the trait defined in the previous section, lets take a look at what a driver would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">#![feature(type_alias_impl_trait)]
#![feature(generic_associated_types)]

pub struct MyCounter {
    value: u32,
}

impl Counter for MyCounter {
    type IncrementFuture&lt;'m&gt; = impl Future&lt;Output = u32&gt; + 'm;
    fn increment&lt;'m&gt;(&amp;'m mut self) -&gt; Self::IncrementFuture&lt;'m&gt; {
        async move {
            self.value += 1;
            self.value
        }
    }

    type AddFuture&lt;'m&gt; = impl Future&lt;Output = u32&gt; + 'm;
    fn add&lt;'m&gt;(&amp;'m mut self, value: u32) -&gt; Self::AddFuture&lt;'m&gt; {
        async move {
            self.value += value;
            self.value
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that we&#8217;ve used yet another nightly feature that allows specifying the
<code>IncrementFuture</code> associated type using the <code>impl Future&lt;&#8230;&#8203;&gt;</code> syntax.</p>
</div>
<div class="paragraph">
<p>At the expense of needing to define the associated type and a somewhat awkward return value, the
driver can write blocks of async code to implement the trait.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
