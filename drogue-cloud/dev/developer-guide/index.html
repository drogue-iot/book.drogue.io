<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developer Guide :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">

      <a class="navbar-item" href="../../..">
        <img class="navbar-brand-image" src="../../../_/img/logo.png" alt="Drogue IoT"/>
      </a>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
          </div>
        </div>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.drogue.io" target="_blank">Project</a>
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-cloud" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Drogue Cloud</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts.html">Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../use-cases/index.html">Use Cases</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/environmental-monitoring.html">Environmental Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/smart-factories.html">Smart Factories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/predictive-maintenance.html">Predictive Maintenance</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/data.html">Data plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/control.html">Control plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/devices.html">Devices, gateways &amp; services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/addons.html">Additional components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/services.html">Noteworthy services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deployment/index.html">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/pre-reqs.html">Pre-Requisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/cluster.html">Prepare the cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/installer.html">Run the installer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/development.html">Deploy from the repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/bare-metal.html">Deploying on bare metal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/monitoring.html">Monitoring a deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/index.html">User Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user-guide/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/common-concepts.html">Common topics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/common-concepts.html">Concepts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/common-configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/common-mqtt-websocket.html">MQTT over websocket</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/management.html">Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/management.html#applications">Applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/management.html#devices">Devices</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/management-app-members.html">Application sharing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/management-rules.html">Event pre-processing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/management-mqtt.html">MQTT dialects</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Endpoints</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-coap.html">CoAP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-http.html">HTTP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-mqtt.html">MQTT Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/integration.html">Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-kafka.html">Apache Kafka™ Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-command.html">HTTP Command Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-knative.html">Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-mqtt.html">MQTT Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-ws.html">WebSocket Integration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Things Network</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/app.html">Managing applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/device.html">Managing devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/endpoints.html">Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/schemas.html">Schemas</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Developer Guide</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Cloud</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../0.9/index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-device/dev/index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-device/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../embassy/dev/index.html">Embassy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../embassy/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Drogue Cloud</a></li>
    <li><a href="index.html">Developer Guide</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">dev</button>
  <div class="version-menu">
    <a class="version is-current" href="index.html">dev</a>
    <a class="version is-missing" href="../../0.9/index.html">0.9</a>
    <a class="version is-missing" href="../../0.8/index.html">0.8</a>
    <a class="version is-missing" href="../../0.7/index.html">0.7</a>
    <a class="version is-missing" href="../../0.6/index.html">0.6</a>
    <a class="version is-missing" href="../../0.5/index.html">0.5</a>
    <a class="version is-missing" href="../../0.4/index.html">0.4</a>
    <a class="version" href="../../0.1/developer-guide/index.html">0.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-cloud/edit/main/docs/modules/developer-guide/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Developer Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is a guide for developers, which would like to work on Drogue Cloud.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In any case, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux, Mac OS X, or Windows on an AMD64 platform (aka <code>x86_64</code>)</p>
<div class="ulist">
<ul>
<li>
<p>Mac OS X in ARM64 (M1, …) seems to be tricky, but should work.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Podman or Docker</p>
<div class="ulist">
<ul>
<li>
<p>Windows containers will not work, you need to use Linux based containers, and again <code>x86_64</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Some tools</p>
<div class="ulist">
<ul>
<li>
<p>git</p>
</li>
<li>
<p>GNU Make</p>
</li>
<li>
<p>npm</p>
</li>
<li>
<p>kubectl</p>
</li>
<li>
<p>HTTPie 2.2+</p>
</li>
</ul>
</div>
</li>
<li>
<p>A lot of cores, patience, memory, and disk space.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_requirements"><a class="anchor" href="#_optional_requirements"></a>Optional requirements</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Rust+</strong> – By default the build will run inside a container image, with Rust included. So you don&#8217;t necessarily
need to install Rust on your local machine. However, having Rust installed might come in handy at some point. If you
want to use an IDE, that might require a Rust installation. Or if you want to quickly run tests, maybe from inside
your IDE, then this will require Rust as well.
+
In any case, you need to be sure that you install at least the version of Rust mentioned above. If you installed
Rust using <code>rustup</code> and default options, then performing an upgrade should be as easy as running <code>rustup update</code>.</p>
</li>
<li>
<p><strong>Kubernetes</strong> - Some form of Kubernetes cluster</p>
<div class="ulist">
<ul>
<li>
<p><strong>Minikube</strong> is what seems to work best for development, and is easy to get started with.</p>
</li>
<li>
<p><strong>Kind</strong> also works, uses less resources, but is less tested.</p>
</li>
<li>
<p><strong>OpenShift</strong> also works and make several things easier (like proper DNS names and certs), but is
also more complex to set up.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>An IDE</strong> – Whatever works best for you. Eclipse, Emacs, IntelliJ, Vim, … <sup class="footnote" id="_footnote_1">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> should all be usable with this project. We do not require
any specific IDE. We also do not commit any IDE specific files either.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operating_system"><a class="anchor" href="#_operating_system"></a>Operating system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are different ways to install the required dependencies on the different operating systems. Some operating
systems also might require some additional settings. This section should help to get you started.</p>
</div>
<div class="sect2">
<h3 id="_fedora"><a class="anchor" href="#_fedora"></a>Fedora</h3>
<div class="paragraph">
<p>Use an "update to date" version of Fedora. Install the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sudo dnf install curl openssl-devel npm gcc gcc-c++ make cyrus-sasl-devel cmake libpq-devel postgresql podman</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_windows"><a class="anchor" href="#_windows"></a>Windows</h3>
<div class="paragraph">
<p>Assuming you have Windows 10 and admin access.</p>
</div>
<div class="paragraph">
<p>Install:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Git for Windows</p>
</li>
<li>
<p>GNU Make 4.x</p>
</li>
<li>
<p>install mingw-w64, as described here: <a href="https://code.visualstudio.com/docs/cpp/config-mingw" class="bare">https://code.visualstudio.com/docs/cpp/config-mingw</a></p>
</li>
<li>
<p>or, install "GNU make" using Chocolatey</p>
</li>
<li>
<p>Docker for Windows</p>
</li>
<li>
<p>Enable WSL2</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Needs more testing
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mac_os"><a class="anchor" href="#_mac_os"></a>Mac OS</h3>
<div class="paragraph">
<p>Most of the required tools you can install using [brew](<a href="https://brew.sh/" class="bare">https://brew.sh/</a>) package manager, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">brew install git make</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using OpenSSL and Cyrus SASL libraries native is still work in progress, so you should use container build for the time being
as described below.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building"><a class="anchor" href="#_building"></a>Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While the build is based on <code>cargo</code>, the build is still driven by the main <code>Makefile</code>, located in
the root of the repository. By default, the cargo build running inside a build container. This reduces
the number of pre-requisites you need to install, and makes it easier on platforms like Windows or Mac OS X.</p>
</div>
<div class="paragraph">
<p>To perform a full build execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">make build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This builds the cargo based projects, the frontend, and the container images.</p>
</div>
<div class="paragraph">
<p>Builds are done using Docker or Podman container runtimes. Podman is preferred if it is present on the system. However, it is
required that Podman supports bind mounts feature properly which is not the case for all platforms today. In that case you can
force Docker runtime with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">CONTAINER=docker make build</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing"><a class="anchor" href="#_testing"></a>Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run all tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">make test</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using podman, you currently cannot use <code>make test</code>. You need to revert
to <code>make container-test</code>, see below.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This runs only the unit tests and integration tests. There is also a system test-suite at
<a href="https://github.com/drogue-iot/drogue-cloud-testing" class="bare">https://github.com/drogue-iot/drogue-cloud-testing</a> which tests a running deployment.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_running_test_on_the_host"><a class="anchor" href="#_running_test_on_the_host"></a>Running test on the host</h3>
<div class="paragraph">
<p>If you have a full build environment on your machine, you can also execute the tests on the host machine,
rather than forking them off in the build container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">make container-test</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ide_based_testing"><a class="anchor" href="#_ide_based_testing"></a>IDE based testing</h3>
<div class="paragraph">
<p>You can also run cargo tests directly from your IDE. How this works, depends on your IDE.</p>
</div>
<div class="paragraph">
<p>However, as tests are compiled and executed on the host machine, the same requirements, as when running
tests on the host machine, apply (see above).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_images"><a class="anchor" href="#_publishing_images"></a>Publishing images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The locally built images can be published with the Makefile as well. For this you need a location to push to.
You can, for example use [quay.io](<a href="https://quay.io" class="bare">https://quay.io</a>). Assuming your username on quay.io is "rodney", and
you did log in using <code>docker login</code>, then you could do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">make push CONTAINER_REGISTRY=quay.io/rodney</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying"><a class="anchor" href="#_deploying"></a>Deploying</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kubernetes_instance"><a class="anchor" href="#_kubernetes_instance"></a>Kubernetes instance</h3>
<div class="paragraph">
<p>Before you can run the deployment, you will need to have access to a Kubernetes cluster. You can run
local cluster using <code>minikube</code>. Make sure that your <code>minikube</code> cluster is started with <code>ingress</code> addon and that you
run <code>tunnel</code> in a separate shell</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">minikube start --cpus 4 --memory 16384 --disk-size 20gb --addons ingress
# in a separate terminal, as it keeps running
minikube tunnel</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_deployment"><a class="anchor" href="#_run_the_deployment"></a>Run the deployment</h3>
<div class="paragraph">
<p>Once the instance is up, and you have ensured that you can access the cluster with <code>kubectl</code>, you can run
the following command to run the deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">make deploy CONTAINER_REGISTRY=quay.io/rodney</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to pass additional arguments to the deploy script, you can use <code>DEPLOY_ARGS</code> environment variable like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">env INSTALL_STRIMZI=false DEPLOY_ARGS="-f deploy/examples/managed_kafka.yaml" make deploy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_helm_charts"><a class="anchor" href="#_helm_charts"></a>Helm charts</h3>
<div class="paragraph">
<p>Helm charts are maintained in the separate repository: <a href="https://github.com/drogue-iot/drogue-cloud-helm-charts" class="bare">https://github.com/drogue-iot/drogue-cloud-helm-charts</a></p>
</div>
<div class="paragraph">
<p>They are however included as a git submodule at the <code>deploy/helm</code> path. A <code>deploy</code> target will initialize the submodule.
If you wish to do it manually run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">git submodule update --init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, to pull changes into the existing workspace run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">git submodule foreach git pull origin main</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to"><a class="anchor" href="#_how_to"></a>How to …</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_work_on_the_frontend"><a class="anchor" href="#_work_on_the_frontend"></a>… work on the frontend</h3>
<div class="paragraph">
<p>You will need to have <code>trunk</code>, <code>npm</code> and <code>sass</code> installed, as it will drive parts of the build.</p>
</div>
<div class="paragraph">
<p><code>trunk</code> can be installed using <code>cargo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cargo install trunk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing <code>sass</code> can be done using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">npm install -g sass@1.52.3</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_backend_detection"><a class="anchor" href="#_backend_detection"></a>Backend detection</h4>
<div class="paragraph">
<p>The frontend needs a way to detect which backend to use. This is done by loading an initial <code>backend.json</code>
from the location of the frontend.</p>
</div>
<div class="paragraph">
<p>For a local development, this file can be provided at <code>console-frontend/dev/endpoints/backend.json</code> or be overridden
by <code>console-frontend/dev/endpoints/backend.local.json</code>. But default files with <code>.local.</code> in that directory will not
be committed to git. The default <code>backend.json</code> is pre-configured to use the "local server" mode, described in the
next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_with_a_local_server"><a class="anchor" href="#_running_with_a_local_server"></a>Running with a local server</h4>
<div class="paragraph">
<p>The simplest way to run the <code>console-backend</code> is to use [<code>drogue-cloud-server</code>](<a href="https://github.com/drogue-iot/drogue-cloud/tree/main/server" class="bare">https://github.com/drogue-iot/drogue-cloud/tree/main/server</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd server
cargo run -- --enable-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have it running (bound to localhost which is the default), you can start the <code>console-frontend</code> in the
development mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd console-frontend
trunk serve</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_with_a_cloud_backend"><a class="anchor" href="#_running_with_a_cloud_backend"></a>Running with a cloud backend</h4>
<div class="paragraph">
<p>You can also run the frontend with a backend in the cloud (or local cluster, e.g. minikube).
To do so, you can create a <code>console-frontend/dev/endpoints/backend.local.json</code> file and populate it with the API and SSO urls of your drogue instance.</p>
</div>
<div class="paragraph">
<p>For example (devbox):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "url": "https://api-drogue-dev.apps.wonderful.iot-playground.org/",
  "openid": {
    "client_id": "drogue",
    "issuer_url": "https://sso-drogue-dev.apps.wonderful.iot-playground.org/realms/drogue"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This model doesn&#8217;t work if your frontend will use newer backend APIs, which are not yet deployed in the cloud.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This list is sorted in alphabetical order, not in the order of any preference.
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
