<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CoAP protocol endpoint :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">

      <a class="navbar-item" href="../../..">
        <img class="navbar-brand-image" src="../../../_/img/logo.png" alt="Drogue IoT"/>
      </a>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
          </div>
        </div>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.drogue.io" target="_blank">Project</a>
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-cloud" data-version="0.9">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Drogue Cloud</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts.html">Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/data.html">Data plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/control.html">Control plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/devices.html">Devices, gateways &amp; services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/addons.html">Additional components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/services.html">Noteworthy services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deployment/index.html">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/pre-reqs.html">Pre-Requisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/cluster.html">Prepare the cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/installer.html">Run the installer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/development.html">Deploy from the repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/bare-metal.html">Deploying on bare metal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/monitoring.html">Monitoring a deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">User Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="management.html">Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="management.html#_applications">Applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="management.html#devices">Devices</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="management-rules.html">Event pre-processing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="management-mqtt.html">MQTT dialects</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Endpoints</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="endpoint-coap.html">CoAP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="endpoint-http.html">HTTP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="endpoint-mqtt.html">MQTT Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-kafka.html">Apache Kafka™ Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-command.html">HTTP Command Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-knative.html">Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-mqtt.html">MQTT Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-ws.html">WebSocket Integration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="common.html">Common topics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="common.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="common-mqtt-websocket.html">MQTT over websocket</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Things Network</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/app.html">Managing applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/device.html">Managing devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/endpoints.html">Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/schemas.html">Schemas</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Cloud</span>
    <span class="version">0.9</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../dev/index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dev/index.html">dev</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-device/dev/index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-device/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../embassy/dev/index.html">Embassy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../embassy/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Drogue Cloud</a></li>
    <li><a href="index.html">User Guide</a></li>
    <li>Endpoints</li>
    <li><a href="endpoint-coap.html">CoAP Endpoint</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.9</button>
  <div class="version-menu">
    <a class="version" href="../../dev/user-guide/endpoint-coap.html">dev</a>
    <a class="version is-current" href="endpoint-coap.html">0.9</a>
    <a class="version" href="../../0.8/user-guide/endpoint-coap.html">0.8</a>
    <a class="version" href="../../0.7/user-guide/endpoint-coap.html">0.7</a>
    <a class="version is-missing" href="../../0.6/index.html">0.6</a>
    <a class="version is-missing" href="../../0.5/index.html">0.5</a>
    <a class="version is-missing" href="../../0.4/index.html">0.4</a>
    <a class="version" href="../../0.1/user-guide/endpoint-coap.html">0.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-cloud/edit/release-0.9/docs/modules/user-guide/pages/endpoint-coap.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CoAP protocol endpoint</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The CoAP protocol endpoint is a device facing service offering connectivity using a CoAP based API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, the endpoint does not support DTLS. It is not recommended to use this in production or
to transfer any sensitive data over public networks.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requests"><a class="anchor" href="#_requests"></a><strong>Requests:</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before communicating with the endpoint, the respective device and application need to be registered with drogue cloud.
The coap requests made to the endpoint need to be of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">coap://&lt;coap-endpoint-address&gt;/v1/{channel}/{subject(optional)}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The UriPath option should be set with v1, channel name and subject name(optional).</p>
</div>
<div class="paragraph">
<p>Optional parameters can also be passed, but they need to be URL encoded. The rules for encoding the
device and application name can be viewed <a href="https://github.com/drogue-iot/rfcs/blob/main/active/0003-cloud-events-mapping.md#common-fields">over here</a>.</p>
</div>
<div class="paragraph">
<p>The following parameters can be passed as queries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>application: The specific application ID that the device is sending telemetry to</p>
</li>
<li>
<p>device: The device ID</p>
</li>
<li>
<p>data_schema: Data schema of the payload</p>
</li>
<li>
<p>as: Allows the device to alias another ID</p>
</li>
<li>
<p>ct: The amount of time the device will wait for incoming commands</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a device to receive commands, it must send a request with a specified timeout.
The command will piggyback on the response—the responsibility to track when the device issues a request and promptly issue the command lies on the application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Authentication information is sent using the <code>CoAP option number 4209</code>. It is carried out using HTTP-like
authentication headers. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Basic ZGV2aWNlMUBhcHAxOmhleS1yb2RuZXk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we use the HTTP Basic authentication scheme, along with the base64 encoded device authentication information.
The format of the device authentication information is <code>&lt;device-id&gt;@&lt;application-id&gt;:&lt;password&gt;</code>.</p>
</div>
<div class="paragraph">
<p>A sample CoAP request would look something like the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Request URL would be formatted like so, with the device name 'device#2' and 'device#4' percentage encoded:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">coap://test-url/v1/sample_channel/sample_subject?application=app1&amp;device=device%232&amp;data_schema=application%2Foctet-stream&amp;as=device%232&amp;ct=30</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The value of Option 4209, representing auth information "device1@app1:hey-rodney":</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Basic ZGV2aWNlMUBhcHAxOmhleS1yb2RuZXk // present as bytes</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Value of the UriPath Option(obtained from request URL):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">v1, Rust, test // present as bytes</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Value of the UriQuery Option(obtained from request URL):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// present as bytes
application=app1&amp;device=device%232&amp;data_schema=application%2Foctet-stream&amp;as=device%234&amp;ct=30</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_response"><a class="anchor" href="#_response"></a><strong>Response:</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two response types that a device can receive.</p>
</div>
<div class="paragraph">
<p>A device would receive a response with the <code>2.04(Changed)</code> status code if the publish action were successful.</p>
</div>
<div class="paragraph">
<p>If the request passed the <code>ct</code>(command timeout) parameter and a command is sent to the device within this interval, the device will receive the <code>2.05(Content)</code> response code. The contents of the command can then be read from the <code>CoAP option 4210</code>.</p>
</div>
<div class="paragraph">
<p>If a request fails, the device can receive responses with appropriate status codes. The payload in such cases will contain the reason for the error as well.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
