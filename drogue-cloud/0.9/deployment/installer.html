<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installer script :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
        <img class="navbar-brand-image" src="../../../_/img/logo.png" alt="Drogue IoT"/>
      </a>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-cloud" data-version="0.9">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Drogue Cloud</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts.html">Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/data.html">Data plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/control.html">Control plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/devices.html">Devices, gateways &amp; services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/addons.html">Additional components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/services.html">Noteworthy services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pre-reqs.html">Pre-Requisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cluster.html">Prepare the cluster</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="installer.html">Run the installer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="development.html">Deploy from the repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bare-metal.html">Deploying on bare metal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring.html">Monitoring a deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tracing.html">Tracing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/index.html">User Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user-guide/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user-guide/management.html">Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-text">TODO: write about upstream and downstream processing</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Endpoints</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-coap.html">CoAP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-http.html">HTTP Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/endpoint-mqtt.html">MQTT Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-kafka.html">Apache Kafka™ Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-command.html">HTTP Command Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-knative.html">Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-mqtt.html">MQTT Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../user-guide/integration-ws.html">WebSocket Integration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user-guide/common.html">Common topics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The Things Network</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/app.html">Managing applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ttn/device.html">Managing devices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/endpoints.html">Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/schemas.html">Schemas</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Cloud</span>
    <span class="version">0.9</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../dev/index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dev/index.html">dev</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-device/dev/index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-device/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../embassy/dev/index.html">Embassy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../embassy/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Drogue Cloud</a></li>
    <li><a href="index.html">Deployment</a></li>
    <li><a href="installer.html">Run the installer</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.9</button>
  <div class="version-menu">
    <a class="version" href="../../dev/deployment/installer.html">dev</a>
    <a class="version is-current" href="installer.html">0.9</a>
    <a class="version" href="../../0.8/deployment/installer.html">0.8</a>
    <a class="version" href="../../0.7/deployment/installer.html">0.7</a>
    <a class="version" href="../../0.6/deployment/installer.html">0.6</a>
    <a class="version" href="../../0.5/deployment/installer.html">0.5</a>
    <a class="version" href="../../0.4/deployment/installer.html">0.4</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-cloud/edit/release-0.9/docs/modules/deployment/pages/installer.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Installer script</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Most of the deployment of Drogue Cloud uses <code>Helm</code> in combination with <code>kubectl</code> for installing dependencies. However, we do require a few steps
before and after the deployment. Installing dependencies on the cluster and setting URLs afterwards.</p>
</div>
<div class="paragraph">
<p>For this we have a <em>magic</em> installer script, that does everything for you. It is suited for an easy start on a
local test cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_download_the_installer_package"><a class="anchor" href="#_download_the_installer_package"></a>Download the installer package</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The installer package is part of the GitHub release record: <a href="https://github.com/drogue-iot/drogue-cloud/releases/latest" class="bare">https://github.com/drogue-iot/drogue-cloud/releases/latest</a></p>
</div>
<div class="paragraph">
<p>There is one package for each type of Kubernetes cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>install-minikube</code> – For using with Minikube</p>
</li>
<li>
<p><code>install-kind</code> – For using with Kind</p>
</li>
<li>
<p><code>install-openshift</code> – For using with OpenShift</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Download the package, matching the cluster you plan to use.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unpacking"><a class="anchor" href="#_unpacking"></a>Unpacking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unzip the package and change into the folder extracted from the archive.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_to_expect"><a class="anchor" href="#_what_to_expect"></a>What to expect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The installer will create a new instance of Drogue Cloud on the cluster you are currently logged in to.</p>
</div>
<div class="paragraph">
<p>By default, this includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installing Strimzi</p>
</li>
<li>
<p>Creating a Kafka cluster</p>
</li>
<li>
<p>Installing the Keycloak operator</p>
</li>
<li>
<p>Create a custom CA for the endpoints</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to install those dependencies manually, for example using OLM, you can opt-out of the installation
(see below).</p>
</div>
<div class="paragraph">
<p>Additionally, it installs Knative and an example application and can install digital twin feature as well. Deployment of these components can be
 configured using installer arguments as explained below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_installer"><a class="anchor" href="#_running_the_installer"></a>Running the installer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the installer script <code>./script/drgadm deploy</code>, adding the options appropriate for your setup.</p>
</div>
<div class="paragraph">
<p>You can use the <code>-c</code> argument to define which cluster type you have.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default cluster type</div>
<div class="paragraph">
<p>By default, the cluster type will be <code>minikube</code> for the script in the repository. For the installers, this default
value will be changed to the installer type you downloaded. You can still override the default, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./script/drgadm deploy -c kind</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_installer_options"><a class="anchor" href="#_additional_installer_options"></a>Additional installer options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>deploy</code> command of <code>drgadm</code> supports the following argument</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-k</code> or <code>INSTALL_DEPS</code></dt>
<dd>
<p>Don&#8217;t install any dependency by default.</p>
</dd>
<dt class="hdlist1"><code>-s &lt;key=value&gt;</code></dt>
<dd>
<p>Set additional Helm values. May be repeated multiple times.</p>
</dd>
<dt class="hdlist1"><code>-m</code></dt>
<dd>
<p>Minimize: Reduces the default resource requests to allow deploying on more constrained environments.</p>
</dd>
<dt class="hdlist1"><code>-d</code> or <code>DOMAIN</code></dt>
<dd>
<p>Manually provide the application DNS domain.</p>
</dd>
<dt class="hdlist1"><code>-c</code> or  <code>CLUSTER</code></dt>
<dd>
<p>Specify the cluster type (any of <code>minikube</code>, <code>kind</code>, <code>openshift</code>, <code>kubernetes</code>).</p>
</dd>
<dt class="hdlist1"><code>-p &lt;profile&gt;</code></dt>
<dd>
<p>Adds an additional Helm value file, named <code>deploy/helm/profiles/&lt;profile&gt;.yaml</code>.</p>
</dd>
<dt class="hdlist1"><code>-t  &lt;timeout&gt;</code></dt>
<dd>
<p>Helm installation timeout (default: 15m)</p>
</dd>
<dt class="hdlist1"><code>-n &lt;namespace&gt;</code> or <code>DROGUE_NS</code></dt>
<dd>
<p>Changes the target Drogue IoT namespace.</p>
</dd>
<dt class="hdlist1"><code>-T</code></dt>
<dd>
<p>Install digital twin feature.</p>
</dd>
<dt class="hdlist1"><code>-e</code></dt>
<dd>
<p>Don&#8217;t install examples.</p>
</dd>
<dt class="hdlist1"><code>-M</code></dt>
<dd>
<p>Deploy metrics</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example: Install Drogue Cloud on <code>kind</code> cluster without dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./script/drgadm deploy -c kind -k</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_skip_the_dependency_installation"><a class="anchor" href="#_skip_the_dependency_installation"></a>Skip the dependency installation</h3>
<div class="paragraph">
<p>The <code>-k</code> argument will skip installing all dependencies. If you want to install of just some of the dependencies (like Strimzi or Keycloak) yourself,
you can opt out of installing them by the script.</p>
</div>
<div class="paragraph">
<p>The installer has a few additional options which are controlled by using environment variables.
You can set them by prefixing the call to the installation script, using <code>env</code> and the variable assignment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">env INSTALL_STRIMZI=false ./script/drgadm deploy</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable Name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSTALL_STRIMZI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${INSTALL_DEPS}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control the installation of Strimzi.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSTALL_KEYCLOAK_OPERATOR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${INSTALL_DEPS}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control the installation of the Keycloak operator.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_install_additional_examples"><a class="anchor" href="#_install_additional_examples"></a>Install additional examples</h3>
<div class="paragraph">
<p>By default the example dashboard is installed by the script. You can turn it off by using <code>-e</code> argument.
Additionally, digital twin feature can be installed by specifying <code>-T</code> argument.
Knative will be installed only if either examples or digital twin feature are installed.
To deploy minimal installation without any examples (and Knative) use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./script/drgadm deploy -e</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_the_target_namespace"><a class="anchor" href="#_change_the_target_namespace"></a>Change the target namespace</h3>
<div class="paragraph">
<p>You can change the namespace where of the Drogue Cloud components get installed using the variable <code>DROGUE_NS</code>. The
default is <code>drogue-iot</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, you can only change the namespace of the Drogue Cloud installation. The namespaces of Knative,
Strimzi, are currently not configurable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_provide_custom_tls_certificates"><a class="anchor" href="#_provide_custom_tls_certificates"></a>Provide custom TLS certificates</h3>
<div class="paragraph">
<p>By default, the installer script will create a custom certificate authority. However, if you already have a key and
certificate, you can instruct the installer to use these. There are two options to achieve this.</p>
</div>
<div class="sect3">
<h4 id="_manually_create_the_tls_secrets"><a class="anchor" href="#_manually_create_the_tls_secrets"></a>Manually create the TLS secrets</h4>
<div class="paragraph">
<p>The installer will check if the secrets <code>http-endpoint-tls</code>, <code>mqtt-endpoint-tls</code> and <code>coap-endpoint-tls</code> exist. If they don&#8217;t it will
create them using generated key and certificate material.</p>
</div>
<div class="paragraph">
<p>If you manually create these TLS secrets, using those names, <strong>before</strong> running the installer, it will not override
these existing secrets. You can do that by running shell commands similar to these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl -n drogue-iot create secret tls http-endpoint-tls --key $PATH_TO_CERT/tls.key --cert $PATH_TO_CERT/tls.crt --dry-run=client -o json | kubectl -n drogue-iot apply -f -
kubectl -n drogue-iot create secret tls mqtt-endpoint-tls --key $PATH_TO_CERT/tls.key --cert $PATH_TO_CERT/tls.crt --dry-run=client -o json | kubectl -n drogue-iot apply -f -
kubectl -n drogue-iot create secret tls coap-endpoint-tls --key $PATH_TO_CERT/tls.key --cert $PATH_TO_CERT/tls.crt --dry-run=client -o json | kubectl -n drogue-iot apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>$PATH_TO_CERT</code> should point to the path location of your certificate.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_re_running_the_installer"><a class="anchor" href="#_re_running_the_installer"></a>Re-running the installer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Should something go wrong, it should be possible to just re-run the installer script. That should simply set the
<em>desired state</em> again, and Kubernetes should reconcile accordingly. In most of the cases, this works just fine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status_information"><a class="anchor" href="#_status_information"></a>Status information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After the installer script has run, it will show some information on how you can connect to the system and
give some example commands to try out.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
