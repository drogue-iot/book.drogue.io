<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin Guide :: Drogue IoT</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4BRXRBJJ1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-Z4BRXRBJJ1')</script>
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.svg" type="image/svg+xml">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">

      <a class="navbar-item" href="../..">
        <img class="navbar-brand-image" src="../../_/img/logo.png" alt="Drogue IoT"/>
      </a>
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs">
          </div>
        </div>

      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.drogue.io" target="_blank">Project</a>
        <a class="navbar-item" href="https://blog.drogue.io" target="_blank">Blog</a>
        <a class="navbar-item" href="https://matrix.to/#/#drogue-iot:matrix.org" target="_blank">Chat</a>
        <a class="navbar-item" href="https://book.drogue.io">Documentation</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drogue-ajour" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Drogue Ajour</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="using.html">User Guide</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="installation.html">Admin Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="protocol.html">Update Protocol</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="image-format.html">Image Format</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="api/index.html">API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api/endpoints.html">Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api/schemas.html">Schemas</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drogue Ajour</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Drogue Ajour</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-cloud/dev/index.html">Drogue Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-cloud/dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.9/index.html">0.9</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../drogue-cloud/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-device/dev/index.html">Drogue Device</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-device/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-doppelgaenger/dev/index.html">Drogue Doppelg√§nger</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-doppelgaenger/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-book/index.html">Drogue IoT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-book/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../drogue-workshops/index.html">Drogue IoT Workshops</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../drogue-workshops/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../drogue-book/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Drogue Ajour</a></li>
    <li><a href="installation.html">Admin Guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/drogue-iot/drogue-ajour/edit/main/docs/modules/ROOT/pages/installation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Admin Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>If you are using an existing installation of Drogue Cloud, such as the <a href="https://sandbox.drogue.cloud">Drogue Cloud Sandbox</a>, it might already have Drogue Ajour enabled.</p>
</div>
<div class="paragraph">
<p>If not, you can install Drogue Ajour either by compiling and running the components yourself, running the provided container images in your favorite container runtime, or deploy it all to Kubernetes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide will cover installation on a Kubernetes cluster using a container registry as the source for firmware.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io">Kubernetes</a></p>
</li>
<li>
<p><a href="https://drogue.io">Drogue Cloud</a></p>
</li>
<li>
<p><a href="https://github.com/drogue-iot/drg">drg</a></p>
</li>
<li>
<p>(Optional) Container Registry - For storing firmware in container images.</p>
</li>
<li>
<p>(Optional) <a href="https://tekton.dev">Tekton</a> - For the firmware build pipeline.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For storing firmware, you can use either an external Eclipse Hawkbit instance or a Container Registry, this guide will assume a container registry being used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_install_files"><a class="anchor" href="#_download_install_files"></a>Download install files</h3>
<div class="paragraph">
<p>The installation manifests can be found on the <a href="https://github.com/drogue-iot/drogue-ajour/releases">GitHub releases</a> page, or by cloning the git repository.</p>
</div>
<div class="paragraph">
<p>Extract the zip file and enter the extracted folder before proceeding with the installation commands.</p>
</div>
</div>
<div class="sect2">
<h3 id="_firmware_delivery"><a class="anchor" href="#_firmware_delivery"></a>Firmware delivery</h3>
<div class="paragraph">
<p>To install the firmware delivery components, you need to create an access token for the server. You can do this from the drogue console or using the <a href="https://github.com/drogue-iot/drg"><code>drg</code></a> command line tool</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Note down the access token generated
drg create token

# You can get these values from your Drogue Cloud console
kubectl create secret generic drogue-config --from-literal=token=&lt;access token&gt; --from-literal=user=&lt;drogue cloud user&gt; --from-literal=registry-url=&lt;drogue API url&gt; --from-literal=mqtt-integration=&lt;drogue MQTT integration URL&gt;

# These values depend on if you're using a builtin container registry or an external one. Using docker.io as example
kubectl create secret generic container-registry --from-literal=prefix=quay.io/myorg/ --from-literal=token=&lt;registry access token&gt;

# Deploy the server
kubectl apply -f deploy/server</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_firmware_build"><a class="anchor" href="#_firmware_build"></a>Firmware build</h3>
<div class="paragraph">
<p>To install the firmware build components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Deploy the API
kubectl apply -f deploy/api

# Deploy Tekton pipelines - This might contain references to Tasks that are not available out of the box
kubectl apply -f deploy/pipeline</pre>
</div>
</div>
<div class="paragraph">
<p>This will also create an externally accessible ingress for the API. You can create your own ingress or edit it in order to change hostname and settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_console"><a class="anchor" href="#_console"></a>Console</h3>
<div class="paragraph">
<p>For this step, you must note down the hostname generated/set for your API ingress above. To deploy the console, we also need a few additional settings in order to enable OIDC authentication. The fields to add are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>issuer-url</code> - the URL of the same OIDC service used by Drogue Cloud.</p>
</li>
<li>
<p><code>client-id</code> - OIDC client id, usually <code>drogue</code>.</p>
</li>
<li>
<p><code>ajour-api-url</code> - The URL to the external API ingress created earlier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To deploy the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl apply -f deploy/console</pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a modified version of the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
